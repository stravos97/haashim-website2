---
import type { Certification } from '../data';

export interface Props {
  certification: Certification;
  index: number;
}

const { certification, index } = Astro.props;
const isPlanned = certification.date.toLowerCase().includes('planned');
---

<article 
  aria-label={`${certification.name} certification`} 
  role="article">
  
  <h3 class="govuk-heading-m cert-title" id={`cert-${index}`}>
    {certification.name}
  </h3>
  
  <p class="govuk-body cert-issuer" aria-describedby={`cert-${index}`}>
    <strong>{certification.issuer}</strong>
  </p>
  
  <p class="govuk-body-s govuk-text-colour--secondary cert-date">
    <time datetime={certification.date}>{certification.date}</time>
  </p>
  {certification.credentialId && (
    <p class="govuk-body cert-id">
      <strong>ID:</strong> {certification.credentialId}
    </p>
  )}
  
  {(certification.description || certification.skills || certification.verificationUrl) && (
    <details class="govuk-details" data-module="govuk-details"
             aria-label="Expand to view certification details">
      <summary class="govuk-details__summary touch-target"
               role="button"
               aria-expanded="false">
        <span class="govuk-details__summary-text">
          Certification details
        </span>
      </summary>
      <div class="govuk-details__text">
        {certification.description && (
          <p class="govuk-body cert-description">
            {certification.description}
          </p>
        )}
        
        {certification.skills && certification.skills.length > 0 && (
          <div class="skills-section">
            <p class="govuk-body font-bold skills-heading">Skills covered:</p>
            <ul class="govuk-list govuk-list--bullet cert-skills-list" role="list">
              {certification.skills.map((skill) => (
                <li role="listitem" class="skill-item">{skill}</li>
              ))}
            </ul>
          </div>
        )}
        
        {certification.verificationUrl && (
          <p class="govuk-body-s verify-link">
            <a href={certification.verificationUrl} 
               class="govuk-link"
               target="_blank"
               rel="noopener noreferrer"
               aria-label={`Verify ${certification.name} certification (opens in new tab)`}>
              Verify certificate â†’
            </a>
          </p>
        )}
      </div>
    </details>
  )}
</article>

<style>
  article {
    padding: var(--spacing-4);
    margin-bottom: var(--spacing-6);
    border-left: 4px solid var(--color-primary);
    transition: all var(--transition-base);
  }

  article:hover {
    background: var(--color-bg-secondary);
    border-left-width: 6px;
    padding-left: calc(var(--spacing-4) - 2px);
  }
  
  .cert-title {
    margin-bottom: var(--govuk-spacing-2);
    font-size: var(--font-size-24);
    line-height: 1.3;
  }
  
  .cert-issuer {
    margin-bottom: var(--govuk-spacing-2);
    font-size: var(--font-size-19);
    line-height: 1.4;
  }
  
  .cert-date {
    margin-bottom: var(--govuk-spacing-3);
    font-size: var(--font-size-16);
    line-height: 1.5;
  }
  
  .cert-id {
    margin-bottom: var(--govuk-spacing-4);
    font-size: var(--font-size-19);
    line-height: 1.5;
  }
  
  .mb-1 {
    margin-bottom: var(--govuk-spacing-1);
  }
  
  .mb-2 {
    margin-bottom: var(--govuk-spacing-2);
  }
  
  .mb-3 {
    margin-bottom: var(--govuk-spacing-3);
  }
  
  .mb-4 {
    margin-bottom: var(--govuk-spacing-4);
  }
  
  .mt-3 {
    margin-top: var(--govuk-spacing-3);
  }
  
  .font-bold {
    font-weight: bold;
  }
  
  .govuk-details {
    margin-bottom: var(--govuk-spacing-4);
  }

  .govuk-details__summary {
    cursor: pointer;
    color: var(--color-link);
    text-underline-offset: 0.1em;
    text-decoration: underline;
    padding: var(--govuk-spacing-2) 0;
  }

  .govuk-details__summary:hover {
    color: var(--color-link-hover);
    text-decoration-thickness: 3px;
  }

  .govuk-details__summary:focus {
    outline: var(--focus-width) solid var(--color-focus);
    outline-offset: 0;
    background-color: var(--color-focus);
    color: var(--color-text);
  }

  .govuk-details__text {
    padding: var(--govuk-spacing-4) 0 var(--govuk-spacing-4) var(--govuk-spacing-5);
    border-left: 5px solid var(--color-border);
    line-height: 1.6;
  }
  
  .cert-description {
    margin-bottom: var(--govuk-spacing-5);
    line-height: 1.7;
    font-size: var(--font-size-19);
  }
  
  .skills-section {
    margin-top: var(--govuk-spacing-4);
  }
  
  .skills-heading {
    margin-bottom: var(--govuk-spacing-3);
    font-size: var(--font-size-19);
  }
  
  .cert-skills-list {
    margin-top: var(--govuk-spacing-2);
    margin-bottom: var(--govuk-spacing-4);
    margin-left: var(--govuk-spacing-4);
  }
  
  .cert-skills-list li {
    margin-bottom: var(--govuk-spacing-2);
    line-height: 1.6;
    font-size: var(--font-size-19);
  }
  
  .cert-skills-list li:last-child {
    margin-bottom: 0;
  }
  
  .verify-link {
    margin-top: var(--govuk-spacing-5);
    padding-top: var(--govuk-spacing-3);
    border-top: 1px solid var(--color-border-light);
  }
  
  .govuk-details__summary-text {
    text-decoration: underline;
  }
  
  .touch-target {
    min-height: 44px;
    display: inline-flex;
    align-items: center;
  }
  
  @media print {
    .govuk-details__summary {
      display: none !important;
    }
    
    .govuk-details__text {
      display: block !important;
      border: none !important;
      padding-left: 0 !important;
    }
  }
</style>